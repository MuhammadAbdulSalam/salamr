#!/bin/bash

: '
If there are no elements for this script
exit the process
'
if [ $# -lt 1 ]; then
  echo "No components found in input, please check input and try again"
  exit 1
fi

IFS=',' read -r -a array <<<"$1"

# Get current script path
script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

: '
handle elements and run actions
@option B - send back press actions
@option S - send swipe action
@option others - locate and tap on item
'
for element in "${array[@]}"; do
  if [ "$element" = "B" ]; then
    adb shell input keyevent KEYCODE_BACK
  elif [ "$element" = "S" ]; then
    bash "$script_dir/swipe"
  else
    echo "processing element: $element"
    adb shell uiautomator dump
    adb pull /sdcard/window_dump.xml .
    bash "$script_dir/locator" "$element"
  fi
done
