#!/bin/bash

: '
get uiautomator screen dump
and get current window_dump.xml file to process
'
adb shell uiautomator dump
adb pull /sdcard/window_dump.xml .
echo "## finding node $1.."

# find element which has text as input
element_info=$(xmlstarlet sel -t -c "//node[@text=\"$1\"]" window_dump.xml)
echo "## finding location.."

: '
get element bounds property
bound property contains x and y coordinates of item on screen
get these x and y coordinates
'
bounds=$(echo "$element_info" | grep -o 'bounds="\[[0-9]*,[0-9]*\]\[[0-9]*,[0-9]*\]"')
x=$(echo "$bounds" | sed -n 's/bounds="\[\([0-9]*\),[0-9]*\]\[[0-9]*,[0-9]*\]"/\1/p')
y=$(echo "$bounds" | sed -n 's/bounds="\[[0-9]*,\([0-9]*\)\]\[[0-9]*,[0-9]*\]"/\1/p')
echo "## node location X: $x, Y: $y"

#perform tap using x and y coordinates
adb shell input tap $x $y
